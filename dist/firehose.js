webpackJsonp([1],[function(e,t,s){window.$=window.jQuery=s(7),$(window),window.Firehose=s(9)},function(e,t,s){var n,o,i,r,c=function(e,t){return function(){return e.apply(t,arguments)}},u=function(e,t){function s(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},a={}.hasOwnProperty;o=s(2),n=function(e){function t(e){this._error=c(this._error,this),this._ping=c(this._ping,this),this._success=c(this._success,this),this.stop=c(this.stop,this),this._requestParams=c(this._requestParams,this),this._request=c(this._request,this),this._protocol=c(this._protocol,this);var s,n,o,i;t.__super__.constructor.call(this,e),null==(s=this.config).ssl&&(s.ssl=!1),(n=this.config).longPoll||(n.longPoll={}),(o=this.config.longPoll).url||(o.url=this._protocol()+":"+this.config.uri),(i=this.config.longPoll).timeout||(i.timeout=25e3),this._lagTime=5e3,this._timeout=this.config.longPoll.timeout+this._lagTime,this._okInterval=this.config.okInterval||0,this._stopRequestLoop=!1,this._lastMessageSequence=0}return u(t,e),t.prototype.messageSequenceHeader="Pragma",t.prototype.name=function(){return"LongPoll"},t.ieSupported=function(){return(document.documentMode||10)>=8},t.supported=function(){var e;return(e=$.ajaxSettings.xhr())?"withCredentials"in e||t.ieSupported():void 0},t.prototype._protocol=function(){return this.config.ssl?"https":"http"},t.prototype._request=function(){var e;if(!this._stopRequestLoop)return e=this._requestParams(),e.last_message_sequence=this._lastMessageSequence,this._lastRequest=$.ajax({url:this.config.longPoll.url,firehose:!0,crossDomain:!0,data:e,timeout:this._timeout,success:this._success,error:this._error,cache:!1})},t.prototype._requestParams=function(){return this.config.params},t.prototype.stop=function(){var e,t,s;if(this._stopRequestLoop=!0,null!=this._lastRequest){try{this._lastRequest.abort()}catch(t){e=t}delete this._lastRequest}if(null!=this._lastPingRequest){try{this._lastPingRequest.abort()}catch(s){e=s}return delete this._lastPingRequest}},t.prototype._success=function(e,t,s){var n,o,i,r,c;if(!this._needToNotifyOfReconnect&&this._succeeded||(this._needToNotifyOfReconnect=!1,this._open(e)),!this._stopRequestLoop){if(200===s.status)try{c=JSON.parse(s.responseText),r=c.message,i=c.last_sequence,_checkDroppedMessages(this._lastMessageSequence,i),this._lastMessageSequence=i||0,this.config.message(this.config.parse(r))}catch(o){n=o}return this.connect(this._okInterval)}},t.prototype._ping=function(){return this._lastPingRequest=$.ajax({url:this.config.uri,method:"HEAD",crossDomain:!0,firehose:!0,data:this._requestParams(),success:function(e){return function(){return e._needToNotifyOfReconnect?(e._needToNotifyOfReconnect=!1,e.config.connected(e)):void 0}}(this)})},t.prototype._error=function(e,t,s){return this._needToNotifyOfReconnect||this._stopRequestLoop||(this._needToNotifyOfReconnect=!0,this.config.disconnected()),this._stopRequestLoop?void 0:(setTimeout(this._ping,this._retryDelay+this._lagTime),setTimeout(this._request,this._retryDelay))},t}(o),("undefined"!=typeof $&&null!==$&&null!=(i=$.browser)?i.msie:void 0)&&(8===(r=parseInt($.browser.version,10))||9===r)&&jQuery.ajaxTransport(function(e){var t;return e.crossDomain&&e.async&&e.firehose?(e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout),t=void 0,{send:function(s,n){var o;return o=function(e,s,o,i){return t.onload=t.onerror=t.ontimeout=jQuery.noop,t=void 0,n(e,s,o,i)},t=new XDomainRequest,t.open(e.type,e.url),t.onload=function(){var e;return e="Content-Type: "+t.contentType,o(200,"OK",{text:t.responseText},e)},t.onerror=function(){return o(404,"Not Found")},t.onprogress=function(){return{}},null!=e.xdrTimeout&&(t.ontimeout=function(){return o(0,"timeout")},t.timeout=e.xdrTimeout),t.send(e.hasContent&&e.data||null)},abort:function(){return null!=t?(t.onerror=jQuery.noop(),t.abort()):void 0}}):void 0}),e.exports=n},function(e,t){var s,n=function(e,t){return function(){return e.apply(t,arguments)}};s=function(){function e(e){var t;null==e&&(e={}),this._checkMultiplexedDroppedMessages=n(this._checkMultiplexedDroppedMessages,this),this._checkDroppedMessages=n(this._checkDroppedMessages,this),this._sequencesDropped=n(this._sequencesDropped,this),this.getLastMessageSequence=n(this.getLastMessageSequence,this),this._close=n(this._close,this),this._open=n(this._open,this),this._error=n(this._error,this),this.connect=n(this.connect,this),this.config=e,(t=this.config).params||(t.params={}),this._retryDelay=3e3}return e.supported=function(){return!1},e.prototype.connect=function(e){return null==e&&(e=0),setTimeout(this._request,e),this},e.prototype.name=function(){throw"not implemented in base Transport"},e.prototype.stop=function(){throw"not implemented in base Transport"},e.prototype._request=function(){throw"not implemented in base Transport"},e.prototype._error=function(e){return this._succeeded?(this.config.disconnected(),this.connect(this._retryDelay)):this.config.failed(this)},e.prototype._open=function(e){return this._succeeded=!0,this.config.connected(this)},e.prototype._close=function(e){return this.config.disconnected()},e.prototype.getLastMessageSequence=function(){return this._lastMessageSequence||0},e.prototype._sequencesDropped=function(e,t,s){var n,o,i,r,c;for(c=[],n=o=i=t,r=t+s;r>=i?r>o:o>r;n=r>=i?++o:--o)c.push(e(n));return c},e.prototype._checkDroppedMessages=function(e){var t;if(this._lastMessageSequence&&e.last_sequence)return t=this._lastMessageSequence-e.last_sequence-1,t>0?this._sequencesDropped(this.config.dropped,e.last_sequence+1,t):void 0},e.prototype._checkMultiplexedDroppedMessages=function(e){var t,s,n;if(this._lastMessageSequence&&e.last_sequence)return(s=this._lastMessageSequence[e.channel])&&(n=s-e.last_sequence-1,n>0&&(t=this.config.channels[e.channel].dropped))?this._sequencesDropped(t,e.last_sequence+1,n):void 0},e}(),e.exports=s},function(e,t,s){(function(t){var n,o,i,r,c,u,a=function(e,t){return function(){return e.apply(t,arguments)}},h=function(e,t){function s(){this.constructor=e}for(var n in t)p.call(t,n)&&(e[n]=t[n]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},p={}.hasOwnProperty;i=s(2),n=2e3,o=2e4,u=function(e){return e.send(JSON.stringify({ping:"PING"}))},c=function(){return("undefined"!=typeof window&&null!==window?window.WebSocket:void 0)||("undefined"!=typeof t&&null!==t?t.WebSocket:void 0)},r=function(e){function t(e){this._clearKeepalive=a(this._clearKeepalive,this),this._restartKeepAlive=a(this._restartKeepAlive,this),this._cleanUp=a(this._cleanUp,this),this._error=a(this._error,this),this._close=a(this._close,this),this._message=a(this._message,this),this.stop=a(this.stop,this),this.sendStartingMessageSequence=a(this.sendStartingMessageSequence,this),this._lookForInitialPong=a(this._lookForInitialPong,this),this._open=a(this._open,this),this._requestParams=a(this._requestParams,this),this._protocol=a(this._protocol,this),this._request=a(this._request,this),this._sendMessage=a(this._sendMessage,this);var s;t.__super__.constructor.call(this,e),(s=this.config).webSocket||(s.webSocket={}),this.config.webSocket.connectionVerified=this.config.connectionVerified}return h(t,e),t.prototype.name=function(){return"WebSocket"},t.ieSupported=function(){return(document.documentMode||10)>9},t.supported=function(){return!!c()},t.prototype._sendMessage=function(e){var t;return null!=(t=this.socket)?t.send(JSON.stringify(e)):void 0},t.prototype._request=function(){var e,t;try{return this.socket=(new c)(this._protocol()+":"+this.config.uri+"?"+$.param(this._requestParams())),this.socket.onopen=this._open,this.socket.onclose=this._close,this.socket.onerror=this._error,this.socket.onmessage=this._lookForInitialPong}catch(t){return e=t,"undefined"!=typeof console&&null!==console?console.log(e):void 0}},t.prototype._protocol=function(){return this.config.ssl?"wss":"ws"},t.prototype._requestParams=function(){return this.config.params},t.prototype._open=function(){return u(this.socket)},t.prototype._lookForInitialPong=function(e){var t;return this._restartKeepAlive(),isPong(function(){var s;try{return JSON.parse(e.data)}catch(s){return t=s,{}}}())?null!=this._lastMessageSequence?this.sendStartingMessageSequence(this._lastMessageSequence):this.config.webSocket.connectionVerified(this):void 0},t.prototype.sendStartingMessageSequence=function(e){return this._lastMessageSequence=e,this.socket.onmessage=this._message,this._sendMessage({message_sequence:e}),this._needToNotifyOfDisconnect=!0,i.prototype._open.call(this)},t.prototype.stop=function(){return this._cleanUp()},t.prototype._message=function(e){var t,s,n;if(n=this.config.parse(e.data),this._restartKeepAlive(),!isPong(n))try{return _checkDroppedMessages(this._lastMessageSequence,n.last_sequence),this._lastMessageSequence=n.last_sequence,this.config.message(this.config.parse(n.message))}catch(s){t=s}},t.prototype._close=function(e){return(null!=e?e.wasClean:void 0)?this._cleanUp():this._error(e)},t.prototype._error=function(e){return this._cleanUp(),this._needToNotifyOfDisconnect&&(this._needToNotifyOfDisconnect=!1,this.config.disconnected()),this._succeeded?this.connect(this._retryDelay):this.config.failed?this.config.failed(this):void 0},t.prototype._cleanUp=function(){return this._clearKeepalive(),null!=this.socket?(this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()):void 0},t.prototype._restartKeepAlive=function(){var e,t;return e=function(e){return function(){return u(e.socket),t()}}(this),t=function(t){return function(){return t.keepaliveTimeout=setTimeout(e,o)}}(this),this._clearKeepalive(),t()},t.prototype._clearKeepalive=function(){return null!=this.keepaliveTimeout?(clearTimeout(this.keepaliveTimeout),this.keepaliveTimeout=null):void 0},t}(i),e.exports=r}).call(t,function(){return this}())},function(e,t,s){var n,o,i,r=function(e,t){return function(){return e.apply(t,arguments)}};i=s(3),o=s(1),n=function(){function e(e){var t,s,n,o,i,c,u,a,h;this.config=null!=e?e:{},this._connectPromise=r(this._connectPromise,this),this._upgradeTransport=r(this._upgradeTransport,this),this.stop=r(this.stop,this),this.connect=r(this.connect,this),this.longpollTransport=r(this.longpollTransport,this),this.websocketTransport=r(this.websocketTransport,this),this.connected=r(this.connected,this),(t=this.config).message||(t.message=function(){}),(s=this.config).error||(s.error=function(){}),(n=this.config).connected||(n.connected=function(){}),(o=this.config).disconnected||(o.disconnected=function(){}),(i=this.config).failed||(i.failed=function(){throw"Could not connect"}),(c=this.config).params||(c.params={}),(u=this.config).parse||(u.parse=JSON.parse),(a=this.config).dropped||(a.dropped=function(){}),this._isConnected=!1,h=this.config.connected,this.config.connected=function(e){return function(){return e._isConnected=!0,h()}}(this)}return e.prototype.connected=function(){return this._isConnected},e.prototype.websocketTransport=function(e){return new i(e)},e.prototype.longpollTransport=function(e){return new o(e)},e.prototype.connect=function(e){var t;return null==e&&(e=0),t=this._connectPromise(),this.config.connectionVerified=this._upgradeTransport,i.supported()&&(this.upgradeTimeout=setTimeout(function(t){return function(){var s;return s=t.websocketTransport(t.config),s.connect(e)}}(this),500)),this.transport=this.longpollTransport(this.config),this.transport.connect(e),t},e.prototype.stop=function(){null!=this.upgradeTimeout&&(clearTimeout(this.upgradeTimeout),this.upgradeTimeout=null),this.transport.stop()},e.prototype._upgradeTransport=function(e){this.transport.stop(),e.sendStartingMessageSequence(this.transport.getLastMessageSequence()),this.transport=e},e.prototype._connectPromise=function(){var e,t;return e=$.Deferred(),t=this.config.connected,this.config.connected=function(s){return function(){return e.resolve(),t?(s.config.connected=t,t()):void 0}}(this),e.promise()},e}(),n.multiplexChannel="channels@firehose",e.exports=n},function(e,t,s){var n,o,i=function(e,t){return function(){return e.apply(t,arguments)}},r=function(e,t){function s(){this.constructor=e}for(var n in t)c.call(t,n)&&(e[n]=t[n]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},c={}.hasOwnProperty,u=[].slice;n=s(1),o=function(e){function t(e){this._success=i(this._success,this),this._subscriptions=i(this._subscriptions,this),this._updateLastMessageSequences=i(this._updateLastMessageSequences,this),this._request=i(this._request,this),this.unsubscribe=i(this.unsubscribe,this),this.subscribe=i(this.subscribe,this),t.__super__.constructor.call(this,e),this._lastMessageSequence={}}return r(t,e),t.prototype.subscribe=function(e,t){},t.prototype.unsubscribe=function(){var e;e=1<=arguments.length?u.call(arguments,0):[]},t.prototype._request=function(){var e;if(!this._stopRequestLoop)return e=this._subscriptions(),this._lastRequest=$.ajax({url:this.config.uri,firehose:!0,crossDomain:!0,method:"POST",data:e,dataType:"json",timeout:this._timeout,success:this._success,error:this._error,cache:!1})},t.prototype._updateLastMessageSequences=function(){var e,t,s,n,o;s=this.config.channels,n=[];for(e in s)t=s[e],(o=this._lastMessageSequence[e])?n.push(t.last_sequence=o):t.last_sequence?n.push(void 0):n.push(t.last_sequence=0);return n},t.prototype._subscriptions=function(){var e,t,s,n;this._updateLastMessageSequences(),n={},s=this.config.channels;for(e in s)t=s[e],n[e]=t.last_sequence||0;return JSON.stringify(n)},t.prototype._success=function(e,t,s){var n,o,i;if(!this._needToNotifyOfReconnect&&this._succeeded||(this._needToNotifyOfReconnect=!1,this._open(e)),!this._stopRequestLoop){if(200===s.status)try{i=JSON.parse(s.responseText),this._lastMessageSequence||(this._lastMessageSequence={}),this._lastMessageSequence[i.channel]=i.last_sequence,this.config.message(i)}catch(o){n=o}return this.connect(this._okInterval)}},t}(n),e.exports=o},function(e,t,s){var n,o,i,r=function(e,t){return function(){return e.apply(t,arguments)}},c=function(e,t){function s(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},u={}.hasOwnProperty,a=[].slice;o=s(3),i=function(e){return"PONG"===e.pong},n=function(e){function t(e){this._message=r(this._message,this),this._open=r(this._open,this),this.getLastMessageSequence=r(this.getLastMessageSequence,this),this.unsubscribe=r(this.unsubscribe,this),this.subscribe=r(this.subscribe,this),t.__super__.constructor.call(this,e)}return c(t,e),t.prototype.subscribe=function(e,t){return this._sendMessage({multiplex_subscribe:{channel:e,message_sequence:t.last_sequence}})},t.prototype.unsubscribe=function(){var e;return e=1<=arguments.length?a.call(arguments,0):[],this._sendMessage({multiplex_unsubscribe:e})},t.prototype.getLastMessageSequence=function(){return this._lastMessageSequence||{}},t.prototype._open=function(){var e,s,n,o;t.__super__._open.call(this),n=this.config.channels,o=[];for(e in n)s=n[e],this._lastMessageSequence&&(s.last_sequence=this._lastMessageSequence[e]),s.last_sequence||(s.last_sequence=0),o.push(this.subscribe(e,s));return o},t.prototype._message=function(e){var t,s,n;if(n=this.config.parse(e.data),this._restartKeepAlive(),!i(n))try{return this._lastMessageSequence||(this._lastMessageSequence={}),this._lastMessageSequence[n.channel]=n.last_sequence,this.config.message(n)}catch(s){t=s}},t}(o),e.exports=n},,function(e,t){e.exports={name:"firehose-client",version:"2.0.0",codeName:"Multiplexed Wonderland",main:"javascript/index.js",scripts:{build:"webpack -p",test:"JASMINE_CONFIG_PATH=./spec/javascripts/support/jasmine.json jasmine"},devDependencies:{"clean-webpack-plugin":"^0.1.9",codo:"git://github.com/coffeedoc/codo.git","coffee-loader":"^0.7.2",coffeelint:"^1.14.0","coffeelint-function-call-whitespace":"^0.1.3","coffeelint-prefer-double-quotes":"^0.1.0","coffeelint-prefer-symbol-operator":"^0.1.1",jasmine:"^2.4.1","json-loader":"^0.5.4",sinon:"^1.17.4",webpack:"^1.13.1"},dependencies:{"coffee-script":"^1.10.0",jquery:"^3.0.0",jsdom:"^9.2.1",ws:"^1.1.0",xmlhttprequest:"^1.8.0"}}},function(e,t,s){t=e.exports=s(10),t.version="2.0.0"},function(e,t,s){e.exports={version:s(8).version,codeName:s(8).codeName,Consumer:s(4),LongPollTransport:s(1),MultiplexedConsumer:s(11),MultiplexedLongPoll:s(5),Transport:s(2),WebSocketTransport:s(3),MultiplexedWebSocket:s(6)}},function(e,t,s){var n,o,i,r,c=function(e,t){return function(){return e.apply(t,arguments)}},u=function(e,t){function s(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},a={}.hasOwnProperty,h=[].slice;n=s(4),r=s(6),i=s(5),o=function(e){function t(e){var s,o,i,r,u;this.config=null!=e?e:{},this.unsubscribe=c(this.unsubscribe,this),this.subscribe=c(this.subscribe,this),this._updateSubscriptions=c(this._updateSubscriptions,this),this._removeSubscriptionHandler=c(this._removeSubscriptionHandler,this),this._addSubscriptionHandler=c(this._addSubscriptionHandler,this),this.message=c(this.message,this),this.longpollTransport=c(this.longpollTransport,this),this.websocketTransport=c(this.websocketTransport,this),this.messageHandlers={},(s=this.config).message||(s.message=this.message),(o=this.config).channels||(o.channels={}),this.config.uri+=n.multiplexChannel,this._updateSubscriptions(),u=this.config.channels;for(i in u)r=u[i],this._addSubscriptionHandler(i,r);t.__super__.constructor.call(this,this.config)}return u(t,e),t.subscriptionQuery=function(e){var t,s;return{subscribe:[function(){var n,o;n=e.channels,o=[];for(t in n)s=n[t],o.push(t+"!"+(s.last_sequence||0));return o}()].join(",")}},t.normalizeChannels=function(e){var t,s,n,o;n=e.channels,o=[];for(t in n)s=n[t],"/"!==t[0]?(delete e.channels[t],o.push(e.channels["/"+t]=s)):o.push(void 0);return o},t.normalizeChannel=function(e){return"/"!==e[0]?"/"+e:e},t.prototype.websocketTransport=function(e){return new r(e)},t.prototype.longpollTransport=function(e){return new i(e)},t.prototype.message=function(e){var t;return(t=this.messageHandlers[e.channel])?t(this.config.parse(e.message)):void 0},t.prototype._addSubscriptionHandler=function(e,t){return t.message?this.messageHandlers[e]=t.message:void 0},t.prototype._removeSubscriptionHandler=function(){var e,t,s,n,o;for(t=1<=arguments.length?h.call(arguments,0):[],o=[],s=0,n=t.length;n>s;s++)e=t[s],o.push(delete this.messageHandlers[e]);return o},t.prototype._updateSubscriptions=function(){return t.normalizeChannels(this.config)},t.prototype.subscribe=function(e,s){return null==s&&(s={}),e=t.normalizeChannel(e),this.config.channels[e]=s,this._updateSubscriptions(),this._addSubscriptionHandler(e,s),this.transport.subscribe(e,s)},t.prototype.unsubscribe=function(){var e,s,n,o,i;if(s=1<=arguments.length?h.call(arguments,0):[],this.connected()){for(n=0,o=s.length;o>n;n++)e=s[n],e=t.normalizeChannel(e),delete this.config.channels[e];return this._updateSubscriptions(),this._removeSubscriptionHandler.apply(this,s),(i=this.transport).unsubscribe.apply(i,s)}},t}(n),e.exports=o}]);
//# sourceMappingURL=firehose.js.map