{"version":3,"sources":["webpack:///firehose.js","webpack:///./helpers/webpack.coffee","webpack:///./javascript/lib/long_poll_transport.coffee","webpack:///./javascript/lib/transport.coffee","webpack:///./javascript/lib/web_socket_transport.coffee","webpack:///./javascript/lib/consumer.coffee","webpack:///./javascript/lib/multiplexed_long_poll.coffee","webpack:///./javascript/lib/multiplexed_web_socket.coffee","webpack:///./package.json","webpack:///./javascript/index.js","webpack:///./javascript/lib/firehose.coffee","webpack:///./javascript/lib/multiplexed_consumer.coffee"],"names":["webpackJsonp","module","exports","__webpack_require__","window","$","jQuery","Firehose","LongPollTransport","Transport","ref","ref1","bind","fn","me","apply","arguments","extend","child","parent","ctor","this","constructor","key","hasProp","call","prototype","__super__","hasOwnProperty","superClass","args","_error","_ping","_success","stop","_requestParams","_request","_protocol","base","base1","base2","base3","config","ssl","longPoll","url","uri","timeout","_lagTime","_timeout","_okInterval","okInterval","_stopRequestLoop","_lastMessageSequence","messageSequenceHeader","name","ieSupported","document","documentMode","supported","xhr","ajaxSettings","data","last_message_sequence","_lastRequest","ajax","firehose","crossDomain","success","error","cache","params","e","error1","error2","abort","_lastPingRequest","status","jqXhr","last_sequence","message","_needToNotifyOfReconnect","_succeeded","_open","JSON","parse","responseText","_checkDroppedMessages","connect","method","_this","connected","disconnected","setTimeout","_retryDelay","browser","msie","parseInt","version","ajaxTransport","s","xdr","async","xdrTimeout","send","_","complete","callback","statusText","responses","responseHeaders","onload","onerror","ontimeout","noop","XDomainRequest","open","type","headers","contentType","text","onprogress","hasContent","_checkMultiplexedDroppedMessages","_sequencesDropped","getLastMessageSequence","_close","delay","event","failed","droppedCallback","startSequence","amount","droppedSequence","i","results","push","droppedCount","dropped","cb","currentServerSequence","channel","channels","global","INITIAL_PING_TIMEOUT","KEEPALIVE_PING_TIMEOUT","WebSocketTransport","getWebSocket","sendPing","socket","stringify","ping","WebSocket","_clearKeepalive","_restartKeepAlive","_cleanUp","_message","sendStartingMessageSequence","_lookForInitialPong","_sendMessage","webSocket","connectionVerified","err","param","onopen","onclose","onmessage","console","log","isPong","message_sequence","_needToNotifyOfDisconnect","frame","wasClean","close","doPing","setNextKeepAlive","keepaliveTimeout","clearTimeout","Consumer","config1","base4","base5","base6","base7","origConnected","_connectPromise","_upgradeTransport","longpollTransport","websocketTransport","_isConnected","promise","upgradeTimeout","ws","transport","deferred","Deferred","resolve","multiplexChannel","MultiplexedLongPoll","slice","_subscriptions","_updateLastMessageSequences","unsubscribe","subscribe","opts","channelNames","length","dataType","seq","subs","MultiplexedWebSocket","o","pong","multiplex_subscribe","multiplex_unsubscribe","codeName","main","scripts","build","test","devDependencies","clean-webpack-plugin","codo","coffee-loader","coffeelint","coffeelint-function-call-whitespace","coffeelint-prefer-double-quotes","coffeelint-prefer-symbol-operator","jasmine","json-loader","sinon","webpack","dependencies","coffee-script","jquery","jsdom","xmlhttprequest","MultiplexedConsumer","_updateSubscriptions","_removeSubscriptionHandler","_addSubscriptionHandler","messageHandlers","subscriptionQuery","join","normalizeChannels","chan","normalizeChannel","msg","handler","len"],"mappings":"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","file":"firehose.js","sourcesContent":["webpackJsonp([1],[\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\twindow.$ = window.jQuery = __webpack_require__(7);\n\t\n\t$(window);\n\t\n\twindow.Firehose = __webpack_require__(9);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar LongPollTransport, Transport, ref, ref1,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty;\n\t\n\tTransport = __webpack_require__(2);\n\t\n\tLongPollTransport = (function(superClass) {\n\t  extend(LongPollTransport, superClass);\n\t\n\t  LongPollTransport.prototype.messageSequenceHeader = 'Pragma';\n\t\n\t  LongPollTransport.prototype.name = function() {\n\t    return 'LongPoll';\n\t  };\n\t\n\t  LongPollTransport.ieSupported = function() {\n\t    return (document.documentMode || 10) >= 8;\n\t  };\n\t\n\t  LongPollTransport.supported = function() {\n\t    var xhr;\n\t    if (xhr = $.ajaxSettings.xhr()) {\n\t      return \"withCredentials\" in xhr || LongPollTransport.ieSupported();\n\t    }\n\t  };\n\t\n\t  function LongPollTransport(args) {\n\t    this._error = bind(this._error, this);\n\t    this._ping = bind(this._ping, this);\n\t    this._success = bind(this._success, this);\n\t    this.stop = bind(this.stop, this);\n\t    this._requestParams = bind(this._requestParams, this);\n\t    this._request = bind(this._request, this);\n\t    this._protocol = bind(this._protocol, this);\n\t    var base, base1, base2, base3;\n\t    LongPollTransport.__super__.constructor.call(this, args);\n\t    if ((base = this.config).ssl == null) {\n\t      base.ssl = false;\n\t    }\n\t    (base1 = this.config).longPoll || (base1.longPoll = {});\n\t    (base2 = this.config.longPoll).url || (base2.url = (this._protocol()) + \":\" + this.config.uri);\n\t    (base3 = this.config.longPoll).timeout || (base3.timeout = 25000);\n\t    this._lagTime = 5000;\n\t    this._timeout = this.config.longPoll.timeout + this._lagTime;\n\t    this._okInterval = this.config.okInterval || 0;\n\t    this._stopRequestLoop = false;\n\t    this._lastMessageSequence = 0;\n\t  }\n\t\n\t  LongPollTransport.prototype._protocol = function() {\n\t    if (this.config.ssl) {\n\t      return \"https\";\n\t    } else {\n\t      return \"http\";\n\t    }\n\t  };\n\t\n\t  LongPollTransport.prototype._request = function() {\n\t    var data;\n\t    if (this._stopRequestLoop) {\n\t      return;\n\t    }\n\t    data = this._requestParams();\n\t    data.last_message_sequence = this._lastMessageSequence;\n\t    return this._lastRequest = $.ajax({\n\t      url: this.config.longPoll.url,\n\t      firehose: true,\n\t      crossDomain: true,\n\t      data: data,\n\t      timeout: this._timeout,\n\t      success: this._success,\n\t      error: this._error,\n\t      cache: false\n\t    });\n\t  };\n\t\n\t  LongPollTransport.prototype._requestParams = function() {\n\t    return this.config.params;\n\t  };\n\t\n\t  LongPollTransport.prototype.stop = function() {\n\t    var e, error1, error2;\n\t    this._stopRequestLoop = true;\n\t    if (this._lastRequest != null) {\n\t      try {\n\t        this._lastRequest.abort();\n\t      } catch (error1) {\n\t        e = error1;\n\t      }\n\t      delete this._lastRequest;\n\t    }\n\t    if (this._lastPingRequest != null) {\n\t      try {\n\t        this._lastPingRequest.abort();\n\t      } catch (error2) {\n\t        e = error2;\n\t      }\n\t      return delete this._lastPingRequest;\n\t    }\n\t  };\n\t\n\t  LongPollTransport.prototype._success = function(data, status, jqXhr) {\n\t    var e, error1, last_sequence, message, ref;\n\t    if (this._needToNotifyOfReconnect || !this._succeeded) {\n\t      this._needToNotifyOfReconnect = false;\n\t      this._open(data);\n\t    }\n\t    if (this._stopRequestLoop) {\n\t      return;\n\t    }\n\t    if (jqXhr.status === 200) {\n\t      try {\n\t        ref = JSON.parse(jqXhr.responseText), message = ref.message, last_sequence = ref.last_sequence;\n\t        _checkDroppedMessages(this._lastMessageSequence, last_sequence);\n\t        this._lastMessageSequence = last_sequence || 0;\n\t        this.config.message(this.config.parse(message));\n\t      } catch (error1) {\n\t        e = error1;\n\t      }\n\t    }\n\t    return this.connect(this._okInterval);\n\t  };\n\t\n\t  LongPollTransport.prototype._ping = function() {\n\t    return this._lastPingRequest = $.ajax({\n\t      url: this.config.uri,\n\t      method: 'HEAD',\n\t      crossDomain: true,\n\t      firehose: true,\n\t      data: this._requestParams(),\n\t      success: (function(_this) {\n\t        return function() {\n\t          if (_this._needToNotifyOfReconnect) {\n\t            _this._needToNotifyOfReconnect = false;\n\t            return _this.config.connected(_this);\n\t          }\n\t        };\n\t      })(this)\n\t    });\n\t  };\n\t\n\t  LongPollTransport.prototype._error = function(jqXhr, status, error) {\n\t    if (!(this._needToNotifyOfReconnect || this._stopRequestLoop)) {\n\t      this._needToNotifyOfReconnect = true;\n\t      this.config.disconnected();\n\t    }\n\t    if (!this._stopRequestLoop) {\n\t      setTimeout(this._ping, this._retryDelay + this._lagTime);\n\t      return setTimeout(this._request, this._retryDelay);\n\t    }\n\t  };\n\t\n\t  return LongPollTransport;\n\t\n\t})(Transport);\n\t\n\tif ((typeof $ !== \"undefined\" && $ !== null ? (ref = $.browser) != null ? ref.msie : void 0 : void 0) && ((ref1 = parseInt($.browser.version, 10)) === 8 || ref1 === 9)) {\n\t  jQuery.ajaxTransport(function(s) {\n\t    var xdr;\n\t    if (s.crossDomain && s.async && s.firehose) {\n\t      if (s.timeout) {\n\t        s.xdrTimeout = s.timeout;\n\t        delete s.timeout;\n\t      }\n\t      xdr = void 0;\n\t      return {\n\t        send: function(_, complete) {\n\t          var callback;\n\t          callback = function(status, statusText, responses, responseHeaders) {\n\t            xdr.onload = xdr.onerror = xdr.ontimeout = jQuery.noop;\n\t            xdr = void 0;\n\t            return complete(status, statusText, responses, responseHeaders);\n\t          };\n\t          xdr = new XDomainRequest();\n\t          xdr.open(s.type, s.url);\n\t          xdr.onload = function() {\n\t            var headers;\n\t            headers = \"Content-Type: \" + xdr.contentType;\n\t            return callback(200, \"OK\", {\n\t              text: xdr.responseText\n\t            }, headers);\n\t          };\n\t          xdr.onerror = function() {\n\t            return callback(404, \"Not Found\");\n\t          };\n\t          xdr.onprogress = function() {\n\t            return {};\n\t          };\n\t          if (s.xdrTimeout != null) {\n\t            xdr.ontimeout = function() {\n\t              return callback(0, \"timeout\");\n\t            };\n\t            xdr.timeout = s.xdrTimeout;\n\t          }\n\t          return xdr.send((s.hasContent && s.data) || null);\n\t        },\n\t        abort: function() {\n\t          if (xdr != null) {\n\t            xdr.onerror = jQuery.noop();\n\t            return xdr.abort();\n\t          }\n\t        }\n\t      };\n\t    }\n\t  });\n\t}\n\t\n\tmodule.exports = LongPollTransport;\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tvar Transport,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\t\n\tTransport = (function() {\n\t  Transport.supported = function() {\n\t    return false;\n\t  };\n\t\n\t  function Transport(config) {\n\t    var base;\n\t    if (config == null) {\n\t      config = {};\n\t    }\n\t    this._checkMultiplexedDroppedMessages = bind(this._checkMultiplexedDroppedMessages, this);\n\t    this._checkDroppedMessages = bind(this._checkDroppedMessages, this);\n\t    this._sequencesDropped = bind(this._sequencesDropped, this);\n\t    this.getLastMessageSequence = bind(this.getLastMessageSequence, this);\n\t    this._close = bind(this._close, this);\n\t    this._open = bind(this._open, this);\n\t    this._error = bind(this._error, this);\n\t    this.connect = bind(this.connect, this);\n\t    this.config = config;\n\t    (base = this.config).params || (base.params = {});\n\t    this._retryDelay = 3000;\n\t    this;\n\t  }\n\t\n\t  Transport.prototype.connect = function(delay) {\n\t    if (delay == null) {\n\t      delay = 0;\n\t    }\n\t    setTimeout(this._request, delay);\n\t    return this;\n\t  };\n\t\n\t  Transport.prototype.name = function() {\n\t    throw 'not implemented in base Transport';\n\t  };\n\t\n\t  Transport.prototype.stop = function() {\n\t    throw 'not implemented in base Transport';\n\t  };\n\t\n\t  Transport.prototype._request = function() {\n\t    throw 'not implemented in base Transport';\n\t  };\n\t\n\t  Transport.prototype._error = function(event) {\n\t    if (this._succeeded) {\n\t      this.config.disconnected();\n\t      return this.connect(this._retryDelay);\n\t    } else {\n\t      return this.config.failed(this);\n\t    }\n\t  };\n\t\n\t  Transport.prototype._open = function(event) {\n\t    this._succeeded = true;\n\t    return this.config.connected(this);\n\t  };\n\t\n\t  Transport.prototype._close = function(event) {\n\t    return this.config.disconnected();\n\t  };\n\t\n\t  Transport.prototype.getLastMessageSequence = function() {\n\t    return this._lastMessageSequence || 0;\n\t  };\n\t\n\t  Transport.prototype._sequencesDropped = function(droppedCallback, startSequence, amount) {\n\t    var droppedSequence, i, ref, ref1, results;\n\t    results = [];\n\t    for (droppedSequence = i = ref = startSequence, ref1 = startSequence + amount; ref <= ref1 ? i < ref1 : i > ref1; droppedSequence = ref <= ref1 ? ++i : --i) {\n\t      results.push(droppedCallback(droppedSequence));\n\t    }\n\t    return results;\n\t  };\n\t\n\t  Transport.prototype._checkDroppedMessages = function(message) {\n\t    var droppedCount;\n\t    if (!this._lastMessageSequence) {\n\t      return;\n\t    }\n\t    if (!message.last_sequence) {\n\t      return;\n\t    }\n\t    droppedCount = this._lastMessageSequence - message.last_sequence - 1;\n\t    if (droppedCount > 0) {\n\t      return this._sequencesDropped(this.config.dropped, message.last_sequence + 1, droppedCount);\n\t    }\n\t  };\n\t\n\t  Transport.prototype._checkMultiplexedDroppedMessages = function(message) {\n\t    var cb, currentServerSequence, droppedCount;\n\t    if (!this._lastMessageSequence) {\n\t      return;\n\t    }\n\t    if (!message.last_sequence) {\n\t      return;\n\t    }\n\t    if (currentServerSequence = this._lastMessageSequence[message.channel]) {\n\t      droppedCount = currentServerSequence - message.last_sequence - 1;\n\t      if (droppedCount > 0 && (cb = this.config.channels[message.channel].dropped)) {\n\t        return this._sequencesDropped(cb, message.last_sequence + 1, droppedCount);\n\t      }\n\t    }\n\t  };\n\t\n\t  return Transport;\n\t\n\t})();\n\t\n\tmodule.exports = Transport;\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(global) {var INITIAL_PING_TIMEOUT, KEEPALIVE_PING_TIMEOUT, Transport, WebSocketTransport, getWebSocket, sendPing,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty;\n\t\n\tTransport = __webpack_require__(2);\n\t\n\tINITIAL_PING_TIMEOUT = 2000;\n\t\n\tKEEPALIVE_PING_TIMEOUT = 20000;\n\t\n\tsendPing = function(socket) {\n\t  return socket.send(JSON.stringify({\n\t    ping: 'PING'\n\t  }));\n\t};\n\t\n\tgetWebSocket = function() {\n\t  return (typeof window !== \"undefined\" && window !== null ? window.WebSocket : void 0) || (typeof global !== \"undefined\" && global !== null ? global.WebSocket : void 0);\n\t};\n\t\n\tWebSocketTransport = (function(superClass) {\n\t  extend(WebSocketTransport, superClass);\n\t\n\t  WebSocketTransport.prototype.name = function() {\n\t    return 'WebSocket';\n\t  };\n\t\n\t  WebSocketTransport.ieSupported = function() {\n\t    return (document.documentMode || 10) > 9;\n\t  };\n\t\n\t  WebSocketTransport.supported = function() {\n\t    return !!getWebSocket();\n\t  };\n\t\n\t  function WebSocketTransport(args) {\n\t    this._clearKeepalive = bind(this._clearKeepalive, this);\n\t    this._restartKeepAlive = bind(this._restartKeepAlive, this);\n\t    this._cleanUp = bind(this._cleanUp, this);\n\t    this._error = bind(this._error, this);\n\t    this._close = bind(this._close, this);\n\t    this._message = bind(this._message, this);\n\t    this.stop = bind(this.stop, this);\n\t    this.sendStartingMessageSequence = bind(this.sendStartingMessageSequence, this);\n\t    this._lookForInitialPong = bind(this._lookForInitialPong, this);\n\t    this._open = bind(this._open, this);\n\t    this._requestParams = bind(this._requestParams, this);\n\t    this._protocol = bind(this._protocol, this);\n\t    this._request = bind(this._request, this);\n\t    this._sendMessage = bind(this._sendMessage, this);\n\t    var base;\n\t    WebSocketTransport.__super__.constructor.call(this, args);\n\t    (base = this.config).webSocket || (base.webSocket = {});\n\t    this.config.webSocket.connectionVerified = this.config.connectionVerified;\n\t  }\n\t\n\t  WebSocketTransport.prototype._sendMessage = function(message) {\n\t    var ref;\n\t    return (ref = this.socket) != null ? ref.send(JSON.stringify(message)) : void 0;\n\t  };\n\t\n\t  WebSocketTransport.prototype._request = function() {\n\t    var err, error;\n\t    try {\n\t      this.socket = new getWebSocket()((this._protocol()) + \":\" + this.config.uri + \"?\" + ($.param(this._requestParams())));\n\t      this.socket.onopen = this._open;\n\t      this.socket.onclose = this._close;\n\t      this.socket.onerror = this._error;\n\t      return this.socket.onmessage = this._lookForInitialPong;\n\t    } catch (error) {\n\t      err = error;\n\t      return typeof console !== \"undefined\" && console !== null ? console.log(err) : void 0;\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype._protocol = function() {\n\t    if (this.config.ssl) {\n\t      return \"wss\";\n\t    } else {\n\t      return \"ws\";\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype._requestParams = function() {\n\t    return this.config.params;\n\t  };\n\t\n\t  WebSocketTransport.prototype._open = function() {\n\t    return sendPing(this.socket);\n\t  };\n\t\n\t  WebSocketTransport.prototype._lookForInitialPong = function(event) {\n\t    var e;\n\t    this._restartKeepAlive();\n\t    if (isPong((function() {\n\t      var error;\n\t      try {\n\t        return JSON.parse(event.data);\n\t      } catch (error) {\n\t        e = error;\n\t        return {};\n\t      }\n\t    })())) {\n\t      if (this._lastMessageSequence != null) {\n\t        return this.sendStartingMessageSequence(this._lastMessageSequence);\n\t      } else {\n\t        return this.config.webSocket.connectionVerified(this);\n\t      }\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype.sendStartingMessageSequence = function(message_sequence) {\n\t    this._lastMessageSequence = message_sequence;\n\t    this.socket.onmessage = this._message;\n\t    this._sendMessage({\n\t      message_sequence: message_sequence\n\t    });\n\t    this._needToNotifyOfDisconnect = true;\n\t    return Transport.prototype._open.call(this);\n\t  };\n\t\n\t  WebSocketTransport.prototype.stop = function() {\n\t    return this._cleanUp();\n\t  };\n\t\n\t  WebSocketTransport.prototype._message = function(event) {\n\t    var e, error, frame;\n\t    frame = this.config.parse(event.data);\n\t    this._restartKeepAlive();\n\t    if (!isPong(frame)) {\n\t      try {\n\t        _checkDroppedMessages(this._lastMessageSequence, frame.last_sequence);\n\t        this._lastMessageSequence = frame.last_sequence;\n\t        return this.config.message(this.config.parse(frame.message));\n\t      } catch (error) {\n\t        e = error;\n\t      }\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype._close = function(event) {\n\t    if (event != null ? event.wasClean : void 0) {\n\t      return this._cleanUp();\n\t    } else {\n\t      return this._error(event);\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype._error = function(event) {\n\t    this._cleanUp();\n\t    if (this._needToNotifyOfDisconnect) {\n\t      this._needToNotifyOfDisconnect = false;\n\t      this.config.disconnected();\n\t    }\n\t    if (this._succeeded) {\n\t      return this.connect(this._retryDelay);\n\t    } else if (this.config.failed) {\n\t      return this.config.failed(this);\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype._cleanUp = function() {\n\t    this._clearKeepalive();\n\t    if (this.socket != null) {\n\t      this.socket.onopen = null;\n\t      this.socket.onclose = null;\n\t      this.socket.onerror = null;\n\t      this.socket.onmessage = null;\n\t      return this.socket.close();\n\t    }\n\t  };\n\t\n\t  WebSocketTransport.prototype._restartKeepAlive = function() {\n\t    var doPing, setNextKeepAlive;\n\t    doPing = (function(_this) {\n\t      return function() {\n\t        sendPing(_this.socket);\n\t        return setNextKeepAlive();\n\t      };\n\t    })(this);\n\t    setNextKeepAlive = (function(_this) {\n\t      return function() {\n\t        return _this.keepaliveTimeout = setTimeout(doPing, KEEPALIVE_PING_TIMEOUT);\n\t      };\n\t    })(this);\n\t    this._clearKeepalive();\n\t    return setNextKeepAlive();\n\t  };\n\t\n\t  WebSocketTransport.prototype._clearKeepalive = function() {\n\t    if (this.keepaliveTimeout != null) {\n\t      clearTimeout(this.keepaliveTimeout);\n\t      return this.keepaliveTimeout = null;\n\t    }\n\t  };\n\t\n\t  return WebSocketTransport;\n\t\n\t})(Transport);\n\t\n\tmodule.exports = WebSocketTransport;\n\t\n\t/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar Consumer, LongPollTransport, WebSocketTransport,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\t\n\tWebSocketTransport = __webpack_require__(3);\n\t\n\tLongPollTransport = __webpack_require__(1);\n\t\n\tConsumer = (function() {\n\t  function Consumer(config1) {\n\t    var base, base1, base2, base3, base4, base5, base6, base7, origConnected;\n\t    this.config = config1 != null ? config1 : {};\n\t    this._connectPromise = bind(this._connectPromise, this);\n\t    this._upgradeTransport = bind(this._upgradeTransport, this);\n\t    this.stop = bind(this.stop, this);\n\t    this.connect = bind(this.connect, this);\n\t    this.longpollTransport = bind(this.longpollTransport, this);\n\t    this.websocketTransport = bind(this.websocketTransport, this);\n\t    this.connected = bind(this.connected, this);\n\t    (base = this.config).message || (base.message = function() {});\n\t    (base1 = this.config).error || (base1.error = function() {});\n\t    (base2 = this.config).connected || (base2.connected = function() {});\n\t    (base3 = this.config).disconnected || (base3.disconnected = function() {});\n\t    (base4 = this.config).failed || (base4.failed = function() {\n\t      throw \"Could not connect\";\n\t    });\n\t    (base5 = this.config).params || (base5.params = {});\n\t    (base6 = this.config).parse || (base6.parse = JSON.parse);\n\t    (base7 = this.config).dropped || (base7.dropped = function() {});\n\t    this._isConnected = false;\n\t    origConnected = this.config.connected;\n\t    this.config.connected = (function(_this) {\n\t      return function() {\n\t        _this._isConnected = true;\n\t        return origConnected();\n\t      };\n\t    })(this);\n\t    this;\n\t  }\n\t\n\t  Consumer.prototype.connected = function() {\n\t    return this._isConnected;\n\t  };\n\t\n\t  Consumer.prototype.websocketTransport = function(config) {\n\t    return new WebSocketTransport(config);\n\t  };\n\t\n\t  Consumer.prototype.longpollTransport = function(config) {\n\t    return new LongPollTransport(config);\n\t  };\n\t\n\t  Consumer.prototype.connect = function(delay) {\n\t    var promise;\n\t    if (delay == null) {\n\t      delay = 0;\n\t    }\n\t    promise = this._connectPromise();\n\t    this.config.connectionVerified = this._upgradeTransport;\n\t    if (WebSocketTransport.supported()) {\n\t      this.upgradeTimeout = setTimeout((function(_this) {\n\t        return function() {\n\t          var ws;\n\t          ws = _this.websocketTransport(_this.config);\n\t          return ws.connect(delay);\n\t        };\n\t      })(this), 500);\n\t    }\n\t    this.transport = this.longpollTransport(this.config);\n\t    this.transport.connect(delay);\n\t    return promise;\n\t  };\n\t\n\t  Consumer.prototype.stop = function() {\n\t    if (this.upgradeTimeout != null) {\n\t      clearTimeout(this.upgradeTimeout);\n\t      this.upgradeTimeout = null;\n\t    }\n\t    this.transport.stop();\n\t  };\n\t\n\t  Consumer.prototype._upgradeTransport = function(ws) {\n\t    this.transport.stop();\n\t    ws.sendStartingMessageSequence(this.transport.getLastMessageSequence());\n\t    this.transport = ws;\n\t  };\n\t\n\t  Consumer.prototype._connectPromise = function() {\n\t    var deferred, origConnected;\n\t    deferred = $.Deferred();\n\t    origConnected = this.config.connected;\n\t    this.config.connected = (function(_this) {\n\t      return function() {\n\t        deferred.resolve();\n\t        if (origConnected) {\n\t          _this.config.connected = origConnected;\n\t          return origConnected();\n\t        }\n\t      };\n\t    })(this);\n\t    return deferred.promise();\n\t  };\n\t\n\t  return Consumer;\n\t\n\t})();\n\t\n\tConsumer.multiplexChannel = \"channels@firehose\";\n\t\n\tmodule.exports = Consumer;\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar LongPollTransport, MultiplexedLongPoll,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty,\n\t  slice = [].slice;\n\t\n\tLongPollTransport = __webpack_require__(1);\n\t\n\tMultiplexedLongPoll = (function(superClass) {\n\t  extend(MultiplexedLongPoll, superClass);\n\t\n\t  function MultiplexedLongPoll(args) {\n\t    this._success = bind(this._success, this);\n\t    this._subscriptions = bind(this._subscriptions, this);\n\t    this._updateLastMessageSequences = bind(this._updateLastMessageSequences, this);\n\t    this._request = bind(this._request, this);\n\t    this.unsubscribe = bind(this.unsubscribe, this);\n\t    this.subscribe = bind(this.subscribe, this);\n\t    MultiplexedLongPoll.__super__.constructor.call(this, args);\n\t    this._lastMessageSequence = {};\n\t  }\n\t\n\t  MultiplexedLongPoll.prototype.subscribe = function(channel, opts) {};\n\t\n\t  MultiplexedLongPoll.prototype.unsubscribe = function() {\n\t    var channelNames;\n\t    channelNames = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n\t  };\n\t\n\t  MultiplexedLongPoll.prototype._request = function() {\n\t    var data;\n\t    if (this._stopRequestLoop) {\n\t      return;\n\t    }\n\t    data = this._subscriptions();\n\t    return this._lastRequest = $.ajax({\n\t      url: this.config.uri,\n\t      firehose: true,\n\t      crossDomain: true,\n\t      method: \"POST\",\n\t      data: data,\n\t      dataType: \"json\",\n\t      timeout: this._timeout,\n\t      success: this._success,\n\t      error: this._error,\n\t      cache: false\n\t    });\n\t  };\n\t\n\t  MultiplexedLongPoll.prototype._updateLastMessageSequences = function() {\n\t    var channel, opts, ref, results, seq;\n\t    ref = this.config.channels;\n\t    results = [];\n\t    for (channel in ref) {\n\t      opts = ref[channel];\n\t      if (seq = this._lastMessageSequence[channel]) {\n\t        results.push(opts.last_sequence = seq);\n\t      } else {\n\t        if (!opts.last_sequence) {\n\t          results.push(opts.last_sequence = 0);\n\t        } else {\n\t          results.push(void 0);\n\t        }\n\t      }\n\t    }\n\t    return results;\n\t  };\n\t\n\t  MultiplexedLongPoll.prototype._subscriptions = function() {\n\t    var channel, opts, ref, subs;\n\t    this._updateLastMessageSequences();\n\t    subs = {};\n\t    ref = this.config.channels;\n\t    for (channel in ref) {\n\t      opts = ref[channel];\n\t      subs[channel] = opts.last_sequence || 0;\n\t    }\n\t    return JSON.stringify(subs);\n\t  };\n\t\n\t  MultiplexedLongPoll.prototype._success = function(data, status, jqXhr) {\n\t    var e, error, message;\n\t    if (this._needToNotifyOfReconnect || !this._succeeded) {\n\t      this._needToNotifyOfReconnect = false;\n\t      this._open(data);\n\t    }\n\t    if (this._stopRequestLoop) {\n\t      return;\n\t    }\n\t    if (jqXhr.status === 200) {\n\t      try {\n\t        message = JSON.parse(jqXhr.responseText);\n\t        this._lastMessageSequence || (this._lastMessageSequence = {});\n\t        this._lastMessageSequence[message.channel] = message.last_sequence;\n\t        this.config.message(message);\n\t      } catch (error) {\n\t        e = error;\n\t      }\n\t    }\n\t    return this.connect(this._okInterval);\n\t  };\n\t\n\t  return MultiplexedLongPoll;\n\t\n\t})(LongPollTransport);\n\t\n\tmodule.exports = MultiplexedLongPoll;\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar MultiplexedWebSocket, WebSocketTransport, isPong,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty,\n\t  slice = [].slice;\n\t\n\tWebSocketTransport = __webpack_require__(3);\n\t\n\tisPong = function(o) {\n\t  return o.pong === 'PONG';\n\t};\n\t\n\tMultiplexedWebSocket = (function(superClass) {\n\t  extend(MultiplexedWebSocket, superClass);\n\t\n\t  function MultiplexedWebSocket(args) {\n\t    this._message = bind(this._message, this);\n\t    this._open = bind(this._open, this);\n\t    this.getLastMessageSequence = bind(this.getLastMessageSequence, this);\n\t    this.unsubscribe = bind(this.unsubscribe, this);\n\t    this.subscribe = bind(this.subscribe, this);\n\t    MultiplexedWebSocket.__super__.constructor.call(this, args);\n\t  }\n\t\n\t  MultiplexedWebSocket.prototype.subscribe = function(channel, opts) {\n\t    return this._sendMessage({\n\t      multiplex_subscribe: {\n\t        channel: channel,\n\t        message_sequence: opts.last_sequence\n\t      }\n\t    });\n\t  };\n\t\n\t  MultiplexedWebSocket.prototype.unsubscribe = function() {\n\t    var channelNames;\n\t    channelNames = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n\t    return this._sendMessage({\n\t      multiplex_unsubscribe: channelNames\n\t    });\n\t  };\n\t\n\t  MultiplexedWebSocket.prototype.getLastMessageSequence = function() {\n\t    return this._lastMessageSequence || {};\n\t  };\n\t\n\t  MultiplexedWebSocket.prototype._open = function() {\n\t    var channel, opts, ref, results;\n\t    MultiplexedWebSocket.__super__._open.call(this);\n\t    ref = this.config.channels;\n\t    results = [];\n\t    for (channel in ref) {\n\t      opts = ref[channel];\n\t      if (this._lastMessageSequence) {\n\t        opts.last_sequence = this._lastMessageSequence[channel];\n\t      }\n\t      if (!opts.last_sequence) {\n\t        opts.last_sequence = 0;\n\t      }\n\t      results.push(this.subscribe(channel, opts));\n\t    }\n\t    return results;\n\t  };\n\t\n\t  MultiplexedWebSocket.prototype._message = function(event) {\n\t    var e, error, frame;\n\t    frame = this.config.parse(event.data);\n\t    this._restartKeepAlive();\n\t    if (!isPong(frame)) {\n\t      try {\n\t        this._lastMessageSequence || (this._lastMessageSequence = {});\n\t        this._lastMessageSequence[frame.channel] = frame.last_sequence;\n\t        return this.config.message(frame);\n\t      } catch (error) {\n\t        e = error;\n\t      }\n\t    }\n\t  };\n\t\n\t  return MultiplexedWebSocket;\n\t\n\t})(WebSocketTransport);\n\t\n\tmodule.exports = MultiplexedWebSocket;\n\n\n/***/ },\n/* 7 */,\n/* 8 */\n/***/ function(module, exports) {\n\n\tmodule.exports = {\n\t\t\"name\": \"firehose-client\",\n\t\t\"version\": \"2.0.0\",\n\t\t\"codeName\": \"Multiplexed Wonderland\",\n\t\t\"main\": \"javascript/index.js\",\n\t\t\"scripts\": {\n\t\t\t\"build\": \"webpack -p\",\n\t\t\t\"test\": \"JASMINE_CONFIG_PATH=./spec/javascripts/support/jasmine.json jasmine\"\n\t\t},\n\t\t\"devDependencies\": {\n\t\t\t\"clean-webpack-plugin\": \"^0.1.9\",\n\t\t\t\"codo\": \"git://github.com/coffeedoc/codo.git\",\n\t\t\t\"coffee-loader\": \"^0.7.2\",\n\t\t\t\"coffeelint\": \"^1.14.0\",\n\t\t\t\"coffeelint-function-call-whitespace\": \"^0.1.3\",\n\t\t\t\"coffeelint-prefer-double-quotes\": \"^0.1.0\",\n\t\t\t\"coffeelint-prefer-symbol-operator\": \"^0.1.1\",\n\t\t\t\"jasmine\": \"^2.4.1\",\n\t\t\t\"json-loader\": \"^0.5.4\",\n\t\t\t\"sinon\": \"^1.17.4\",\n\t\t\t\"webpack\": \"^1.13.1\"\n\t\t},\n\t\t\"dependencies\": {\n\t\t\t\"coffee-script\": \"^1.10.0\",\n\t\t\t\"jquery\": \"^3.0.0\",\n\t\t\t\"jsdom\": \"^9.2.1\",\n\t\t\t\"ws\": \"^1.1.0\",\n\t\t\t\"xmlhttprequest\": \"^1.8.0\"\n\t\t}\n\t};\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tif (false) {\n\t  require(\"coffee-script/register\");\n\t  __VERSION__ = require(\"../helpers/node\").version\n\t}\n\t\n\texports = module.exports = __webpack_require__(10);\n\texports.version = (\"2.0.0\");\n\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = {\n\t  version: __webpack_require__(8).version,\n\t  codeName: __webpack_require__(8).codeName,\n\t  Consumer: __webpack_require__(4),\n\t  LongPollTransport: __webpack_require__(1),\n\t  MultiplexedConsumer: __webpack_require__(11),\n\t  MultiplexedLongPoll: __webpack_require__(5),\n\t  Transport: __webpack_require__(2),\n\t  WebSocketTransport: __webpack_require__(3),\n\t  MultiplexedWebSocket: __webpack_require__(6)\n\t};\n\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar Consumer, MultiplexedConsumer, MultiplexedLongPoll, MultiplexedWebSocket,\n\t  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty,\n\t  slice = [].slice;\n\t\n\tConsumer = __webpack_require__(4);\n\t\n\tMultiplexedWebSocket = __webpack_require__(6);\n\t\n\tMultiplexedLongPoll = __webpack_require__(5);\n\t\n\tMultiplexedConsumer = (function(superClass) {\n\t  extend(MultiplexedConsumer, superClass);\n\t\n\t  MultiplexedConsumer.subscriptionQuery = function(config) {\n\t    var channel, opts;\n\t    return {\n\t      subscribe: [\n\t        (function() {\n\t          var ref, results;\n\t          ref = config.channels;\n\t          results = [];\n\t          for (channel in ref) {\n\t            opts = ref[channel];\n\t            results.push(channel + \"!\" + (opts.last_sequence || 0));\n\t          }\n\t          return results;\n\t        })()\n\t      ].join(\",\")\n\t    };\n\t  };\n\t\n\t  MultiplexedConsumer.normalizeChannels = function(config) {\n\t    var chan, opts, ref, results;\n\t    ref = config.channels;\n\t    results = [];\n\t    for (chan in ref) {\n\t      opts = ref[chan];\n\t      if (chan[0] !== \"/\") {\n\t        delete config.channels[chan];\n\t        results.push(config.channels[\"/\" + chan] = opts);\n\t      } else {\n\t        results.push(void 0);\n\t      }\n\t    }\n\t    return results;\n\t  };\n\t\n\t  MultiplexedConsumer.normalizeChannel = function(channel) {\n\t    if (channel[0] !== \"/\") {\n\t      return \"/\" + channel;\n\t    } else {\n\t      return channel;\n\t    }\n\t  };\n\t\n\t  function MultiplexedConsumer(config1) {\n\t    var base, base1, channel, opts, ref;\n\t    this.config = config1 != null ? config1 : {};\n\t    this.unsubscribe = bind(this.unsubscribe, this);\n\t    this.subscribe = bind(this.subscribe, this);\n\t    this._updateSubscriptions = bind(this._updateSubscriptions, this);\n\t    this._removeSubscriptionHandler = bind(this._removeSubscriptionHandler, this);\n\t    this._addSubscriptionHandler = bind(this._addSubscriptionHandler, this);\n\t    this.message = bind(this.message, this);\n\t    this.longpollTransport = bind(this.longpollTransport, this);\n\t    this.websocketTransport = bind(this.websocketTransport, this);\n\t    this.messageHandlers = {};\n\t    (base = this.config).message || (base.message = this.message);\n\t    (base1 = this.config).channels || (base1.channels = {});\n\t    this.config.uri += Consumer.multiplexChannel;\n\t    this._updateSubscriptions();\n\t    ref = this.config.channels;\n\t    for (channel in ref) {\n\t      opts = ref[channel];\n\t      this._addSubscriptionHandler(channel, opts);\n\t    }\n\t    MultiplexedConsumer.__super__.constructor.call(this, this.config);\n\t  }\n\t\n\t  MultiplexedConsumer.prototype.websocketTransport = function(config) {\n\t    return new MultiplexedWebSocket(config);\n\t  };\n\t\n\t  MultiplexedConsumer.prototype.longpollTransport = function(config) {\n\t    return new MultiplexedLongPoll(config);\n\t  };\n\t\n\t  MultiplexedConsumer.prototype.message = function(msg) {\n\t    var handler;\n\t    if (handler = this.messageHandlers[msg.channel]) {\n\t      return handler(this.config.parse(msg.message));\n\t    }\n\t  };\n\t\n\t  MultiplexedConsumer.prototype._addSubscriptionHandler = function(channel, opts) {\n\t    if (opts.message) {\n\t      return this.messageHandlers[channel] = opts.message;\n\t    }\n\t  };\n\t\n\t  MultiplexedConsumer.prototype._removeSubscriptionHandler = function() {\n\t    var chan, channelNames, i, len, results;\n\t    channelNames = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n\t    results = [];\n\t    for (i = 0, len = channelNames.length; i < len; i++) {\n\t      chan = channelNames[i];\n\t      results.push(delete this.messageHandlers[chan]);\n\t    }\n\t    return results;\n\t  };\n\t\n\t  MultiplexedConsumer.prototype._updateSubscriptions = function() {\n\t    return MultiplexedConsumer.normalizeChannels(this.config);\n\t  };\n\t\n\t  MultiplexedConsumer.prototype.subscribe = function(channel, opts) {\n\t    if (opts == null) {\n\t      opts = {};\n\t    }\n\t    channel = MultiplexedConsumer.normalizeChannel(channel);\n\t    this.config.channels[channel] = opts;\n\t    this._updateSubscriptions();\n\t    this._addSubscriptionHandler(channel, opts);\n\t    return this.transport.subscribe(channel, opts);\n\t  };\n\t\n\t  MultiplexedConsumer.prototype.unsubscribe = function() {\n\t    var channel, channelNames, i, len, ref;\n\t    channelNames = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n\t    if (!this.connected()) {\n\t      return;\n\t    }\n\t    for (i = 0, len = channelNames.length; i < len; i++) {\n\t      channel = channelNames[i];\n\t      channel = MultiplexedConsumer.normalizeChannel(channel);\n\t      delete this.config.channels[channel];\n\t    }\n\t    this._updateSubscriptions();\n\t    this._removeSubscriptionHandler.apply(this, channelNames);\n\t    return (ref = this.transport).unsubscribe.apply(ref, channelNames);\n\t  };\n\t\n\t  return MultiplexedConsumer;\n\t\n\t})(Consumer);\n\t\n\tmodule.exports = MultiplexedConsumer;\n\n\n/***/ }\n]);\n\n\n/** WEBPACK FOOTER **\n ** firehose.js\n **/","window.$ = window.jQuery = require \"jquery\"\n\n$(window)\n\nwindow.Firehose = require \"../javascript/index.js\"\n\n\n\n/** WEBPACK FOOTER **\n ** ./helpers/webpack.coffee\n **/","Transport = require \"./transport\"\n\nclass LongPollTransport extends Transport\n  messageSequenceHeader: 'Pragma'\n  name: -> 'LongPoll'\n\n  # CORS is kinda supported in IE8+ except that its implementation cannot\n  # access \"simple request\" response headers. This means we don't yet have a\n  # plan to support IE<10 (when it gets a real XHR2 implementation). Sucks...\n  # $.browser.msie and parseInt($.browser.version) >= 8 # DEPRECATED\n  @ieSupported: -> (document.documentMode || 10) >= 8\n\n  @supported: ->\n    # IE 8+, FF 3.5+, Chrome 4+, Safari 4+, Opera 12+, iOS 3.2+, Android 2.1+\n    if xhr = $.ajaxSettings.xhr()\n      \"withCredentials\" of xhr || LongPollTransport.ieSupported()\n\n  constructor: (args) ->\n    super args\n\n    @config.ssl ?= false\n\n    # Configrations specifically for long polling\n    @config.longPoll         ||= {}\n    @config.longPoll.url     ||= \"#{@_protocol()}:#{@config.uri}\"\n    # How many ms should we wait before timing out the AJAX connection?\n    @config.longPoll.timeout ||= 25000\n    # TODO - What is @_lagTime for? Can't we just use the @_timeout value?\n    # We use the lag time to make the client live longer than the server.\n    @_lagTime                  = 5000\n    @_timeout                  = @config.longPoll.timeout + @_lagTime\n    @_okInterval               = @config.okInterval || 0\n    @_stopRequestLoop          = false\n    @_lastMessageSequence      = 0\n\n  # Protocol schema we should use for talking to firehose server.\n  _protocol: =>\n    if @config.ssl then \"https\" else \"http\"\n\n  _request: =>\n    return if @_stopRequestLoop\n    # Set the Last Message Sequence in a query string.\n    # Ideally we'd use an HTTP header, but android devices don't let us\n    # set any HTTP headers for CORS requests.\n    data = @_requestParams()\n    data.last_message_sequence = @_lastMessageSequence\n    # TODO: Some of these options will be deprecated in jQuery 1.8\n    #       See: http://api.jquery.com/jQuery.ajax/#jqXHR\n    @_lastRequest = $.ajax\n      url:          @config.longPoll.url\n      firehose:     true\n      crossDomain:  true\n      data:         data\n      timeout:      @_timeout\n      success:      @_success\n      error:        @_error\n      cache:        false\n\n  _requestParams: =>\n    @config.params\n\n  stop: =>\n    @_stopRequestLoop = true\n    if @_lastRequest?\n      try @_lastRequest.abort() catch e\n      delete @_lastRequest\n    if @_lastPingRequest?\n      try @_lastPingRequest.abort() catch e\n      delete @_lastPingRequest\n\n  _success: (data, status, jqXhr) =>\n    if @_needToNotifyOfReconnect or not @_succeeded\n      @_needToNotifyOfReconnect = false\n      @_open data\n    return if @_stopRequestLoop\n    if jqXhr.status is 200\n      # Of course, IE's XDomainRequest doesn't support non-200 success codes.\n      try\n        {message, last_sequence} = JSON.parse jqXhr.responseText\n        _checkDroppedMessages(@_lastMessageSequence, last_sequence)\n        @_lastMessageSequence    = last_sequence || 0\n        @config.message @config.parse message\n      catch e\n    @connect @_okInterval\n\n  _ping: =>\n    # Ping long poll server to verify internet connectivity\n    # jQuery CORS doesn't support timeouts and there is no way to access xhr2 object\n    # directly so we can't manually set a timeout.\n    @_lastPingRequest = $.ajax\n      url:          @config.uri\n      method:       'HEAD'\n      crossDomain:  true\n      firehose:     true\n      data:         @_requestParams()\n      success:      =>\n        if @_needToNotifyOfReconnect\n          @_needToNotifyOfReconnect = false\n          @config.connected @\n\n  # We need this custom handler to have the connection status\n  # properly displayed\n  _error: (jqXhr, status, error) =>\n    unless @_needToNotifyOfReconnect or @_stopRequestLoop\n      @_needToNotifyOfReconnect = true\n      @config.disconnected()\n    unless @_stopRequestLoop\n      # Ping the server to make sure this isn't a network connectivity error\n      setTimeout @_ping, @_retryDelay + @_lagTime\n      # Reconnect with delay\n      setTimeout @_request, @_retryDelay\n\n# Let's try to hack in support for IE8-9 via the XDomainRequest object!\n# This was adapted from code shamelessly stolen from:\n# https://github.com/jaubourg/ajaxHooks/blob/master/src/ajax/xdr.js\nif $?.browser?.msie and parseInt($.browser.version, 10) in [8, 9]\n  jQuery.ajaxTransport (s) ->\n    if s.crossDomain and s.async and s.firehose\n      if s.timeout\n        s.xdrTimeout = s.timeout\n        delete s.timeout\n      xdr = undefined\n      return {\n        send: (_, complete) ->\n          callback = (status, statusText, responses, responseHeaders) ->\n            xdr.onload = xdr.onerror = xdr.ontimeout = jQuery.noop\n            xdr = undefined\n            complete status, statusText, responses, responseHeaders\n\n          xdr = new XDomainRequest()\n\n          xdr.open s.type, s.url\n\n          xdr.onload = ->\n            headers = \"Content-Type: #{xdr.contentType}\"\n            callback 200, \"OK\", {text: xdr.responseText}, headers\n\n          xdr.onerror = -> callback 404, \"Not Found\"\n\n          # This is critical for long poll to work in IE9.\n          # Without it, the initial request will work but\n          # subsequent requests will fail silently.\n          # http://social.msdn.microsoft.com/Forums/ie/en-US/30ef3add-767c-4436-b8a9-f1ca19b4812e/ie9-rtm-xdomainrequest-issued-requests-may-abort-if-all-event-handlers-not-specified?forum=iewebdevelopment\n          xdr.onprogress = -> {}\n\n          if s.xdrTimeout?\n            xdr.ontimeout = -> callback 0, \"timeout\"\n            xdr.timeout   = s.xdrTimeout\n\n          xdr.send (s.hasContent and s.data) or null\n\n        abort: ->\n          if xdr?\n            xdr.onerror = jQuery.noop()\n            xdr.abort()\n      }\n\nmodule.exports = LongPollTransport\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/long_poll_transport.coffee\n **/","class Transport\n  # Class method to determine whether transport is supported by the current browser. Note that while\n  # the transport may be supported by the browser, its possible that the network connection won't\n  # succeed. That should be accounted for during the initial connecting to the server.\n  @supported: =>\n    false\n\n  constructor: (config={}) ->\n    @config = config\n    @config.params ||= {}\n\n    @_retryDelay = 3000\n    @\n\n  # Lets rock'n'roll! Connect to the server.\n  connect: (delay = 0) =>\n    setTimeout @_request, delay\n    this\n\n  # Hey subclasses:\n  name: ->     throw 'not implemented in base Transport' # implement this to identify transport type\n  stop: ->     throw 'not implemented in base Transport' # implement this to stop receiving messages\n  _request: -> throw 'not implemented in base Transport' # implement this to handle requests\n\n  # Default error handler\n  _error: (event) =>\n    if @_succeeded\n      # Lets try to connect again with delay\n      @config.disconnected()\n      @connect(@_retryDelay)\n    else @config.failed @\n\n  # Default connection established handler\n  _open: (event) =>\n    @_succeeded = true\n    @config.connected(@)\n\n  # Default connection closed handler\n  _close: (event) =>\n    @config.disconnected()\n\n  # Useful for reconnecting after any networking hiccups\n  getLastMessageSequence: =>\n    @_lastMessageSequence or 0\n\n  _sequencesDropped: (droppedCallback, startSequence, amount) =>\n    for droppedSequence in [startSequence...startSequence + amount]\n      droppedCallback(droppedSequence)\n\n  _checkDroppedMessages: (message) =>\n    unless @_lastMessageSequence\n      return\n\n    unless message.last_sequence\n      return\n\n    droppedCount = @_lastMessageSequence - message.last_sequence - 1 # don't count last message we got\n    if droppedCount > 0\n      @_sequencesDropped(@config.dropped, message.last_sequence + 1, droppedCount)\n\n  _checkMultiplexedDroppedMessages: (message) =>\n    unless @_lastMessageSequence\n      return\n\n    unless message.last_sequence\n      return\n\n    if currentServerSequence = @_lastMessageSequence[message.channel]\n      droppedCount = currentServerSequence - message.last_sequence - 1 # don't count last message we got\n      if droppedCount > 0 && cb = @config.channels[message.channel].dropped\n        @_sequencesDropped(cb, message.last_sequence + 1, droppedCount)\n\nmodule.exports = Transport\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/transport.coffee\n **/","Transport = require \"./transport\"\n\nINITIAL_PING_TIMEOUT   =  2000\nKEEPALIVE_PING_TIMEOUT = 20000\n\nsendPing = (socket) ->\n  socket.send JSON.stringify ping: 'PING'\n\ngetWebSocket = ->\n  window?.WebSocket || global?.WebSocket\n\nclass WebSocketTransport extends Transport\n  name: -> 'WebSocket'\n\n  @ieSupported:-> (document.documentMode || 10) > 9\n  @supported  :-> !!getWebSocket() # Check if WebSocket is an object in the window.\n\n  constructor: (args) ->\n    super args\n    # Configrations specifically for web sockets\n    @config.webSocket ||= {}\n    @config.webSocket.connectionVerified = @config.connectionVerified\n\n  _sendMessage: (message) =>\n    @socket?.send(JSON.stringify message)\n\n  _request: =>\n    # Run this in a try/catch block because IE10 inside of a .NET control\n    # complains about security zones.\n    try\n      @socket = new getWebSocket()(\"#{@_protocol()}:#{@config.uri}?#{$.param @_requestParams()}\")\n      @socket.onopen    = @_open\n      @socket.onclose   = @_close\n      @socket.onerror   = @_error\n      @socket.onmessage = @_lookForInitialPong\n    catch err\n      console?.log(err)\n\n  # Protocol schema we should use for talking to firehose server.\n  _protocol: =>\n    if @config.ssl then \"wss\" else \"ws\"\n\n  _requestParams: =>\n    @config.params\n\n  _open: =>\n    sendPing @socket\n\n  _lookForInitialPong: (event) =>\n    @_restartKeepAlive()\n    if isPong(try JSON.parse event.data catch e then {})\n      if @_lastMessageSequence?\n        # don't callback to connectionVerified on subsequent reconnects\n        @sendStartingMessageSequence @_lastMessageSequence\n      else @config.webSocket.connectionVerified @\n\n  sendStartingMessageSequence: (message_sequence) =>\n    @_lastMessageSequence = message_sequence\n    @socket.onmessage     = @_message\n    @_sendMessage({message_sequence})\n    @_needToNotifyOfDisconnect = true\n    Transport::_open.call @\n\n  stop: =>\n    @_cleanUp()\n\n  _message: (event) =>\n    frame = @config.parse event.data\n    @_restartKeepAlive()\n    unless isPong frame\n      try\n        _checkDroppedMessages(@_lastMessageSequence, frame.last_sequence)\n        @_lastMessageSequence = frame.last_sequence\n        @config.message @config.parse frame.message\n      catch e\n\n  _close: (event) =>\n    if event?.wasClean then @_cleanUp()\n    else @_error event\n\n  _error: (event) =>\n    @_cleanUp()\n    if @_needToNotifyOfDisconnect\n      @_needToNotifyOfDisconnect = false\n      @config.disconnected()\n    if @_succeeded\n      @connect @_retryDelay\n    else if @config.failed\n      @config.failed @\n\n  _cleanUp: =>\n    @_clearKeepalive()\n    if @socket?\n      @socket.onopen    = null\n      @socket.onclose   = null\n      @socket.onerror   = null\n      @socket.onmessage = null\n      @socket.close()\n      # delete @socket\n\n  _restartKeepAlive: =>\n    doPing = =>\n      sendPing @socket\n      setNextKeepAlive()\n    setNextKeepAlive = =>\n      @keepaliveTimeout = setTimeout doPing, KEEPALIVE_PING_TIMEOUT\n    @_clearKeepalive()\n    setNextKeepAlive()\n\n  _clearKeepalive: =>\n    if @keepaliveTimeout?\n      clearTimeout @keepaliveTimeout\n      @keepaliveTimeout = null\n\nmodule.exports = WebSocketTransport\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/web_socket_transport.coffee\n **/","WebSocketTransport = require \"./web_socket_transport\"\nLongPollTransport = require \"./long_poll_transport\"\n\nclass Consumer\n  constructor: (@config = {}) ->\n    # Empty handler for messages.\n    @config.message      ||= ->\n    # Empty handler for error handling.\n    @config.error        ||= ->\n    # Empty handler for when we establish a connection.\n    @config.connected    ||= ->\n    # Empty handler for when we're disconnected.\n    @config.disconnected ||= ->\n    # The initial connection failed. This is probably triggered when a\n    # transport, like WebSockets is supported by the browser, but for whatever\n    # reason it can't connect (probably a firewall)\n    @config.failed       ||= ->\n      throw \"Could not connect\"\n    # Params that we'll tack on to the URL.\n    @config.params       ||= {}\n    # Do stuff before we send the message into config.message. The sensible\n    # default on the webs is to parse JSON.\n    @config.parse        ||= JSON.parse\n    # callback that get's called if the client missed messages due to a\n    # disconnect or any other issue\n    @config.dropped      ||= ->\n\n    @_isConnected = false\n    origConnected = @config.connected\n    @config.connected = =>\n      @_isConnected = true\n      origConnected()\n\n    # Make sure we return ourself out of the constructor so we can chain.\n    this\n\n  connected: =>\n    @_isConnected\n\n  websocketTransport: (config) =>\n    new WebSocketTransport(config)\n\n  longpollTransport: (config) =>\n    new LongPollTransport(config)\n\n  connect: (delay=0) =>\n    promise = @_connectPromise()\n\n    @config.connectionVerified = @_upgradeTransport\n    if WebSocketTransport.supported()\n      @upgradeTimeout = setTimeout =>\n        ws = @websocketTransport(@config)\n        ws.connect delay\n      , 500\n    @transport = @longpollTransport(@config)\n    @transport.connect delay\n\n    promise\n\n  stop: =>\n    if @upgradeTimeout?\n      clearTimeout @upgradeTimeout\n      @upgradeTimeout = null\n    @transport.stop()\n    return\n\n  _upgradeTransport: (ws) =>\n    @transport.stop()\n    ws.sendStartingMessageSequence @transport.getLastMessageSequence()\n    @transport = ws\n    return\n\n  # Return a promise that will succeed/fail depending on whether or not the\n  # initial connection succeeds.\n  _connectPromise: =>\n    deferred = $.Deferred()\n\n    origConnected = @config.connected\n    @config.connected = =>\n      deferred.resolve()\n      if origConnected\n        @config.connected = origConnected\n        origConnected()\n\n  #  origDisconnected = @config.disconnected\n  #  @config.disconnected = =>\n  #    deferred.reject()\n  #    if origDisconnected\n  #      @config.disconnected = origDisconnected\n  #      origDisconnected()\n\n    deferred.promise()\n\nConsumer.multiplexChannel = \"channels@firehose\"\n\nmodule.exports = Consumer\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/consumer.coffee\n **/","LongPollTransport = require \"./long_poll_transport\"\n\nclass MultiplexedLongPoll extends LongPollTransport\n  constructor: (args) ->\n    super args\n    @_lastMessageSequence = {}\n\n  subscribe: (channel, opts) =>\n    # nothing to be done\n\n  unsubscribe: (channelNames...) =>\n    # same here\n\n  _request: =>\n    return if @_stopRequestLoop\n    data = @_subscriptions()\n\n    @_lastRequest = $.ajax\n      url:          @config.uri\n      firehose:     true\n      crossDomain:  true\n      method:       \"POST\"\n      data:         data\n      dataType:     \"json\"\n      timeout:      @_timeout\n      success:      @_success\n      error:        @_error\n      cache:        false\n\n  _updateLastMessageSequences: =>\n    for channel, opts of @config.channels\n      if seq = @_lastMessageSequence[channel]\n        opts.last_sequence = seq\n      else\n        unless opts.last_sequence\n          opts.last_sequence = 0\n\n  _subscriptions: =>\n    @_updateLastMessageSequences()\n    subs = {}\n    for channel, opts of @config.channels\n      subs[channel] = opts.last_sequence || 0\n    JSON.stringify(subs)\n\n  _success: (data, status, jqXhr) =>\n    if @_needToNotifyOfReconnect or not @_succeeded\n      @_needToNotifyOfReconnect = false\n      @_open data\n    return if @_stopRequestLoop\n    if jqXhr.status is 200\n      # Of course, IE's XDomainRequest doesn't support non-200 success codes.\n      try\n        message = JSON.parse jqXhr.responseText\n        @_lastMessageSequence ||= {}\n        @_lastMessageSequence[message.channel] = message.last_sequence\n        @config.message message\n      catch e\n    @connect @_okInterval\n\nmodule.exports = MultiplexedLongPoll\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/multiplexed_long_poll.coffee\n **/","WebSocketTransport = require \"./web_socket_transport\"\n\nisPong = (o) ->\n  o.pong is 'PONG'\n\nclass MultiplexedWebSocket extends WebSocketTransport\n  constructor: (args) ->\n    super args\n\n  subscribe: (channel, opts) =>\n    @_sendMessage\n      multiplex_subscribe:\n        channel: channel\n        message_sequence: opts.last_sequence\n\n  unsubscribe: (channelNames...) =>\n    @_sendMessage\n      multiplex_unsubscribe: channelNames\n\n  getLastMessageSequence: =>\n    @_lastMessageSequence or {}\n\n  _open: =>\n    super()\n    for channel, opts of @config.channels\n      if @_lastMessageSequence\n        opts.last_sequence = @_lastMessageSequence[channel]\n\n      unless opts.last_sequence\n        opts.last_sequence = 0\n\n      @subscribe channel, opts\n\n  _message: (event) =>\n    frame = @config.parse event.data\n    @_restartKeepAlive()\n    unless isPong frame\n      try\n        @_lastMessageSequence ||= {}\n        @_lastMessageSequence[frame.channel] = frame.last_sequence\n        @config.message frame\n      catch e\n\nmodule.exports = MultiplexedWebSocket\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/multiplexed_web_socket.coffee\n **/","module.exports = {\n\t\"name\": \"firehose-client\",\n\t\"version\": \"2.0.0\",\n\t\"codeName\": \"Multiplexed Wonderland\",\n\t\"main\": \"javascript/index.js\",\n\t\"scripts\": {\n\t\t\"build\": \"webpack -p\",\n\t\t\"test\": \"JASMINE_CONFIG_PATH=./spec/javascripts/support/jasmine.json jasmine\"\n\t},\n\t\"devDependencies\": {\n\t\t\"clean-webpack-plugin\": \"^0.1.9\",\n\t\t\"codo\": \"git://github.com/coffeedoc/codo.git\",\n\t\t\"coffee-loader\": \"^0.7.2\",\n\t\t\"coffeelint\": \"^1.14.0\",\n\t\t\"coffeelint-function-call-whitespace\": \"^0.1.3\",\n\t\t\"coffeelint-prefer-double-quotes\": \"^0.1.0\",\n\t\t\"coffeelint-prefer-symbol-operator\": \"^0.1.1\",\n\t\t\"jasmine\": \"^2.4.1\",\n\t\t\"json-loader\": \"^0.5.4\",\n\t\t\"sinon\": \"^1.17.4\",\n\t\t\"webpack\": \"^1.13.1\"\n\t},\n\t\"dependencies\": {\n\t\t\"coffee-script\": \"^1.10.0\",\n\t\t\"jquery\": \"^3.0.0\",\n\t\t\"jsdom\": \"^9.2.1\",\n\t\t\"ws\": \"^1.1.0\",\n\t\t\"xmlhttprequest\": \"^1.8.0\"\n\t}\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./package.json\n ** module id = 8\n ** module chunks = 1\n **/","if (\"webpack\" != process.env.NODE_ENV) {\n  require(\"coffee-script/register\");\n  __VERSION__ = require(\"../helpers/node\").version\n}\n\nexports = module.exports = require(\"./lib/firehose\");\nexports.version = __VERSION__;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./javascript/index.js\n ** module id = 9\n ** module chunks = 1\n **/","module.exports =\n  version: require(\"../../package.json\").version\n  codeName: require(\"../../package.json\").codeName\n  Consumer: require \"./consumer\"\n  LongPollTransport: require \"./long_poll_transport\"\n  MultiplexedConsumer: require \"./multiplexed_consumer\"\n  MultiplexedLongPoll: require \"./multiplexed_long_poll\"\n  Transport: require \"./transport\"\n  WebSocketTransport: require \"./web_socket_transport\"\n  MultiplexedWebSocket: require \"./multiplexed_web_socket\"\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/firehose.coffee\n **/","Consumer = require \"./consumer\"\nMultiplexedWebSocket = require \"./multiplexed_web_socket\"\nMultiplexedLongPoll = require \"./multiplexed_long_poll\"\n\nclass MultiplexedConsumer extends Consumer\n  @subscriptionQuery: (config) ->\n    {\n      subscribe: [\n        \"#{channel}!#{opts.last_sequence || 0}\" for channel, opts of config.channels\n      ].join(\",\")\n    }\n\n  @normalizeChannels: (config) ->\n    for chan, opts of config.channels\n      if chan[0] != \"/\"\n        delete config.channels[chan]\n        config.channels[\"/\" + chan] = opts\n\n  @normalizeChannel: (channel) ->\n    if channel[0] != \"/\"\n      return \"/\" + channel\n    else\n      return channel\n\n  constructor: (@config = {}) ->\n    @messageHandlers = {}\n    @config.message ||= @message\n    @config.channels ||= {}\n    @config.uri += Consumer.multiplexChannel\n\n    @_updateSubscriptions()\n\n    for channel, opts of @config.channels\n      @_addSubscriptionHandler(channel, opts)\n\n    super(@config)\n\n  websocketTransport: (config) =>\n    new MultiplexedWebSocket(config)\n\n  longpollTransport: (config) =>\n    new MultiplexedLongPoll(config)\n\n  message: (msg) =>\n    if handler = @messageHandlers[msg.channel]\n      handler(@config.parse msg.message)\n\n  _addSubscriptionHandler: (channel, opts) =>\n    if opts.message\n      @messageHandlers[channel] = opts.message\n\n  _removeSubscriptionHandler: (channelNames...) =>\n    for chan in channelNames\n      delete @messageHandlers[chan]\n\n  _updateSubscriptions: =>\n    MultiplexedConsumer.normalizeChannels(@config)\n\n  subscribe: (channel, opts = {}) =>\n    channel = MultiplexedConsumer.normalizeChannel(channel)\n    @config.channels[channel] = opts\n\n    @_updateSubscriptions()\n    @_addSubscriptionHandler(channel, opts)\n    @transport.subscribe(channel, opts)\n\n  unsubscribe: (channelNames...) =>\n    return unless @connected()\n\n    for channel in channelNames\n      channel = MultiplexedConsumer.normalizeChannel(channel)\n      delete @config.channels[channel]\n\n    @_updateSubscriptions()\n    @_removeSubscriptionHandler(channelNames...)\n    @transport.unsubscribe(channelNames...)\n\nmodule.exports = MultiplexedConsumer\n\n\n\n/** WEBPACK FOOTER **\n ** ./javascript/lib/multiplexed_consumer.coffee\n **/"],"sourceRoot":""}